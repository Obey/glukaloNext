<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>WORMMEAGAIN</title>
<meta property="og:image" content="Dvaem89ESe.png" />
<meta property="og:title" content="Ещё одна червеобразная форма" />
<meta property="og:description" content="Не, ну а чо" />
	

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<script type="text/javascript" src="js/mdb.min.js"></script>-->
     <link rel="stylesheet" href="css/mdb.min.css">
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
     <link rel="stylesheet" href="css/w3.css">
     <link rel="stylesheet" href="https://shop.zabor-ss.ru/new/depend/jquery-ui-1.12.1.custom/jquery-ui.min.css">
     <script src="https://shop.zabor-ss.ru/new/depend/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
     <script src="https://shop.zabor-ss.ru/new/depend/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/jquery-3.5.1.min.js"></script>

  <link rel="stylesheet" href="https://shop.zabor-ss.ru/OWL/dist/assets/owl.carousel.css">
  <script src="https://shop.zabor-ss.ru/OWL/dist/owl.carousel.min.js"></script>

  <script src="https://shop.zabor-ss.ru/bootstrap/5.0.0b/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://shop.zabor-ss.ru/bootstrap/5.0.0b/css/bootstrap.min.css">

  <!-- Babylon.js -->
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/ammo.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/cannon.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/Oimo.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/libktx.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/earcut.min.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/babylon.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/inspector/babylon.inspector.bundle.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/materialsLibrary/babylonjs.materials.min.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/loaders/babylonjs.loaders.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/loaders/babylon.objFileLoader.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/serializers/babylonjs.serializers.min.js"></script>
  <script src="https://shop.zabor-ss.ru/3d_obj/babylonjs_full/gui/babylon.gui.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/jquery-3.5.1.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-1.8.2/angular.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-1.8.2/angular-animate.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-1.8.2/angular-route.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-1.8.2/angular-aria.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-1.8.2/angular-messages.min.js"></script>
  <script src="https://shop.zabor-ss.ru/new/depend/angular-filter.min.js"></script>


    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
            font-family: 'Open Sans';
            color: white;
             
        }

        a {
            color: white;
        }





        #title {
            grid-row: 1;
            grid-column: 1;
            margin: 20px;
            align-self: center;
            justify-self: center;
        }

        #description {
            grid-row: 2;
            grid-column: 1;
            margin: 20px;
            align-self: center;
            justify-self: center;
        }

        .container {
            grid-row: 3;
            grid-column: 1;
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0;
            display: grid;
            grid-template-columns: 45% 10% 45%;
            grid-template-rows: 45% 10% 45%;
        }




       </style>

    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 90vh;
            touch-action: none;
        }
        #upr {
            position: fixed;
            top: 0px;

            z-index: 4000;

        }

    .hidden {display: none;}
    </style>
  </head>

    <body ng-app="myApp" ng-controller="myCtrl">
	    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/ru_RU/sdk.js#xfbml=1&autoLogAppEvents=1&version=v10.0&appId=186162668099890" nonce="UodN9yGR"></script>	    
	    
	<div style="top: 15px; left: 15px; z-index: 5000;" class="fb-like" data-colorscheme="light" data-href="https://obey.github.io/glukaloNext/" data-width="" data-layout="standard" data-action="like" data-size="small" data-share="true"></div>
  <div class="container-fluid rounded bg-white text-center">

    <canvas class="mx-auto" id="renderCanvas"></canvas>
    <hr />
    {{alpha}}
<input type="range" ng-init="alpha = 0.5" ng-model="alpha"  min="-2" max="2" step="0.001"> 
   
</div>  <script>
 var app = angular.module('myApp', []);

app.controller('myCtrl', function($scope) {
   
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        // script importation
        var url = "https://cdn.rawgit.com/BabylonJS/Extensions/master/Polyhedron/polyhedra.js";
        var s = document.createElement("script");
        s.src = url;
        document.head.appendChild(s);

        var createScene = function () {
         var scene = new BABYLON.Scene(engine);
         $scope.windowWidth = $( window ).width();
  $scope.windowHeight = $( window ).height();

     scene.clearColor = new BABYLON.Color4.FromHexString('#FFFFFFFF');
    //    scene.clearColor = new BABYLON.Color4.FromHexString('#000000FF');
       scene.environmentTexture = BABYLON.CubeTexture.CreateFromPrefilteredData(
    "https://playground.babylonjs.com/textures/environment.dds",
    scene
  );
            var camera = new BABYLON.ArcRotateCamera("camera1",  0, 0, 0, new BABYLON.Vector3(0, 0, -0), scene);
              
              camera.attachControl(canvas, true);
              var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(-1, 0.5, 0), scene);
              light.intensity = 0.9;
              var pl = new BABYLON.PointLight("pl", new BABYLON.Vector3(0,.5, 2), scene);
              pl.diffuse = new BABYLON.Color3(1, 1, 1);
              //pl.specular = new BABYLON.Color3(1, 0, 0);
              pl.intensity = 0.0;
              camera.fov = 0.89;


              camera.setPosition(new BABYLON.Vector3(0, 0, -4));
              
              if ($scope.windowHeight > $scope.windowWidth) {
                camera.setPosition(new BABYLON.Vector3(0, 0, -4));
                camera.alpha = Math.PI;
                 }

                 
                 camera.lowerRadiusLimit = camera.upperRadiusLimit = camera.radius;


              var mat2 = new BABYLON.StandardMaterial("mat1", scene);        
              mat2.diffuseColor = new BABYLON.Color3(1, 1, 1);

  var mat = new BABYLON.StandardMaterial("mat1", scene);
 
// mat.diffuseColor = new BABYLON.Color3(0.94, 0.61, 0.08);
 mat.backFaceCulling = false;
//mat.wireframe = true;
  mat.diffuseTexture = new BABYLON.Texture("/images/dikiykamen3.jpg", scene);
//  mat.bumpTexture = new BABYLON.Texture("/images/dikiykamen3.jpg", scene);
       mat.diffuseTexture.uOffset = $scope.alpha/2;
       mat.diffuseTexture.vOffset = 1.0;
 
       mat.alpha =  $scope.alpha;
 

      
  var pbr = new BABYLON.PBRMaterial("pbr", scene);
  pbr.subSurface.isRefractionEnabled = true;
  pbr.subSurface.indexOfRefraction = 1.5;
  pbr.environmentTexture = BABYLON.CubeTexture.CreateFromPrefilteredData("/textures/environment.dds", scene);
    
  var oct = function (M = 57) {
    let skeletons = [];
    let parentAnchor = null;
    // var M = 57;
    for (let i = 2; i < M; i++) {
      let d = i / M / 10;
      let height = (1 / M) * 7;

      let mesh = BABYLON.MeshBuilder.CreateCylinder(
        "cylinder",
        { height: height, diameter: (0.1 - d) * 0.5, tessellation: 6 },
        scene
      );
      mesh.position.y = height / 2;

      //   mesh.parent = BABYLON.Mesh.CreateSphere("sphere", 6, 0.19 - d, scene);

      let cubemesh = BABYLON.MeshBuilder.CreateBox(
        "box",
        { size: 0.15 - d },
        scene
      );

      let cubemeshL = cubemesh.clone("cubemeshL");
      cubemeshL.scaling = new BABYLON.Vector3(0.5, 0.7, 0.7);
      cubemeshL.rotation.x = Math.PI / 4;
      cubemeshL.position.x -= (0.17 - d) * 1;

      let cubemeshR = cubemesh.clone("cubemeshL");
      cubemeshR.scaling = new BABYLON.Vector3(0.5, 0.7, 0.7);
      cubemeshR.rotation.x = Math.PI / 4;
      cubemeshR.position.x += (0.17 - d) * 1;

      mesh.parent = BABYLON.Mesh.MergeMeshes(
        [cubemesh, cubemeshL, cubemeshR],
        true,
        true,
        undefined,
        false,
        true
      );
      mesh.parent.position.y = height / 2 + 0;

      let sidemesh = BABYLON.MeshBuilder.CreateCylinder(
        "cylinder",
        { height: 0.23 - d, diameter: (0.1 - d) * 0.5, tessellation: 32 },
        scene
      ); /* */
      sidemesh.rotation.x = Math.PI / 2;
      sidemesh.rotation.z = Math.PI / 2;
      sidemesh.parent = mesh.parent;

      //mesh.position.x = height / 4;
      mesh.parent.enableEdgesRendering();
      mesh.parent.edgesWidth = 1;
      mesh.parent.edgesColor = new BABYLON.Color4(0, 0, 0, 0.5);
      mesh.parent.material = pbr;
      mesh.parent.parent = parentAnchor;
      parentAnchor = mesh;
      skeletons.push(mesh);
    }

    skeletons[0].parent.position.y -= 1.5;

    return skeletons;
  };

  var skeletons = [];
  skeletons = oct(42);

  let t = 0;
  scene.registerBeforeRender(function () {
    for (let i in skeletons) {
      if (!skeletons[i].parent) continue;

      let sint = Math.cos(t * i);
      let poX = Math.sin(t)  * 0.03 * i   * $scope.alpha;
      let poZ = ((Math.sin(t) * sint) / 45) * poX;
      skeletons[i].parent.rotation.x= poX;
      skeletons[i].parent.rotation.z = poX * sint;
      skeletons[i].parent.rotation.y = poZ;
    }
    t += 0.005;

    camera.alpha += 0.001;
  });

  // The main render loop.
  const renderLoop = () => {
    //  light.intensity = mutable lightx;

    // shape.isVisible = mutable chk;
    // shape.scaling.y = mutable scaling_y;

    pbr.subSurface.tintColor = new BABYLON.Color3.FromHexString("#FFFFFF");
    pbr.metallic = 1;
    pbr.roughness = 0;

    //  shape.rotation.x -= 0.013;
    scene.render();
  };

  var a = 0;
  scene.beforeRender = () => {
    a += 0.01;
    pbr.subSurface.tintColor.g = Math.cos(a) * 0.5 + 0.5;
    pbr.subSurface.tintColor.b = pbr.subSurface.tintColor.g;
  };

   



         return scene;
        };
                var engine;
                var scene;
                initFunction = async function() {
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    engine = await asyncEngineCreation();
        if (!engine) throw 'engine should not be null.';
        scene = createScene();};
        initFunction().then(() => {sceneToRender = scene
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        }); 
      });
    </script>
</body>
<?$js_debug = $_GET['jsd'];?>

<script type="text/javascript" src="our_js3/babylon_part.js<?if(!$js_debug) echo ('?' . time());?>"></script>


</html>
